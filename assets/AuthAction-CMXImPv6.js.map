{"version":3,"file":"AuthAction-CMXImPv6.js","sources":["../../src/components/auth/AuthAction.vue"],"sourcesContent":["<script setup>\nimport { ref, onMounted } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { useAuthStore } from '@/store/auth';\nimport { useUIStore } from '@/store/ui';\nimport BaseInput from '../base/BaseInput.vue';\nimport BaseButton from '../base/BaseButton.vue';\nimport BaseModal from '../base/BaseModal.vue';\n\nconst route = useRoute();\nconst router = useRouter();\nconst authStore = useAuthStore();\nconst uiStore = useUIStore();\n\nconst showResetModal = ref(false);\nconst mode = ref('');\nconst oobCode = ref('');\nconst newPassword = ref('');\nconst confirmPassword = ref('');\nconst processing = ref(false);\nconst verificationComplete = ref(false);\n\nonMounted(async () => {\n  // Get the mode and oob code from the URL\n  const urlParams = new URLSearchParams(window.location.search);\n  mode.value = urlParams.get('mode');\n  oobCode.value = urlParams.get('oobCode');\n\n  if (mode.value === 'resetPassword' && oobCode.value) {\n    try {\n      processing.value = true;\n      await authStore.verifyResetCode(oobCode.value);\n      verificationComplete.value = true;\n      showResetModal.value = true;\n      // Clean up the URL without refreshing the page\n      window.history.replaceState({}, document.title, '/');\n    } catch (error) {\n      uiStore.setError('resetPassword', 'Link inválido ou expirado. Por favor, solicite uma nova redefinição de senha.');\n      router.push('/');\n    } finally {\n      processing.value = false;\n    }\n  }\n});\n\nasync function handlePasswordReset() {\n  if (newPassword.value !== confirmPassword.value) {\n    uiStore.setError('resetPassword', 'As senhas não coincidem');\n    return;\n  }\n\n  try {\n    processing.value = true;\n    await authStore.confirmPasswordChange(oobCode.value, newPassword.value);\n    uiStore.setSuccess('resetPassword', 'Senha alterada com sucesso');\n    showResetModal.value = false;\n    router.push('/');\n  } catch (error) {\n    uiStore.setError('resetPassword', error.message);\n  } finally {\n    processing.value = false;\n  }\n}\n\nfunction handleModalClose() {\n  if (!processing.value) {\n    showResetModal.value = false;\n    router.push('/');\n  }\n}\n</script>\n\n<template>\n  <BaseModal\n    v-model=\"showResetModal\"\n    title=\"Redefinir Senha\"\n    :show-close=\"!processing\"\n    @close=\"handleModalClose\"\n  >\n    <div v-if=\"mode === 'resetPassword'\" class=\"reset-password-form\">\n      <div v-if=\"verificationComplete\" class=\"form-content\">\n        <BaseInput\n          v-model=\"newPassword\"\n          type=\"password\"\n          placeholder=\"Nova senha\"\n          :disabled=\"processing\"\n        />\n        \n        <BaseInput\n          v-model=\"confirmPassword\"\n          type=\"password\"\n          placeholder=\"Confirme a nova senha\"\n          :disabled=\"processing\"\n        />\n        \n        <BaseButton\n          @click=\"handlePasswordReset\"\n          :loading=\"processing\"\n          :disabled=\"!newPassword || !confirmPassword || processing\"\n        >\n          Confirmar nova senha\n        </BaseButton>\n      </div>\n      \n      <div v-else-if=\"processing\" class=\"loading-state\">\n        <p>Verificando...</p>\n      </div>\n    </div>\n  </BaseModal>\n</template>\n\n<style scoped>\n.reset-password-form {\n  width: 100%;\n  text-align: center;\n}\n\n.form-content {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-top: 1rem;\n}\n\n.loading-state {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 100px;\n}\n</style>"],"names":["useRoute","router","useRouter","authStore","useAuthStore","uiStore","useUIStore","showResetModal","ref","mode","oobCode","newPassword","confirmPassword","processing","verificationComplete","async","handlePasswordReset","value","confirmPasswordChange","setSuccess","push","error","setError","message","handleModalClose","onMounted","urlParams","URLSearchParams","window","location","search","get","verifyResetCode","history","replaceState","document","title"],"mappings":"4SASsBA,IACtB,MAAMC,EAASC,IACTC,EAAYC,IACZC,EAAUC,IAEVC,EAAiBC,GAAI,GACrBC,EAAOD,EAAI,IACXE,EAAUF,EAAI,IACdG,EAAcH,EAAI,IAClBI,EAAkBJ,EAAI,IACtBK,EAAaL,GAAI,GACjBM,EAAuBN,GAAI,GAyBjCO,eAAeC,IACT,GAAAL,EAAYM,QAAUL,EAAgBK,MAKtC,IACFJ,EAAWI,OAAQ,QACbd,EAAUe,sBAAsBR,EAAQO,MAAON,EAAYM,OACzDZ,EAAAc,WAAW,gBAAiB,8BACpCZ,EAAeU,OAAQ,EACvBhB,EAAOmB,KAAK,IACb,OAAQC,GACChB,EAAAiB,SAAS,gBAAiBD,EAAME,QAC5C,CAAY,QACRV,EAAWI,OAAQ,CACvB,MAdYZ,EAAAiB,SAAS,gBAAiB,0BAetC,CAEA,SAASE,IACFX,EAAWI,QACdV,EAAeU,OAAQ,EACvBhB,EAAOmB,KAAK,KAEhB,QA/CAK,GAAUV,UAER,MAAMW,EAAY,IAAIC,gBAAgBC,OAAOC,SAASC,QAItD,GAHKrB,EAAAQ,MAAQS,EAAUK,IAAI,QACnBrB,EAAAO,MAAQS,EAAUK,IAAI,WAEX,kBAAftB,EAAKQ,OAA6BP,EAAQO,MACxC,IACFJ,EAAWI,OAAQ,QACbd,EAAU6B,gBAAgBtB,EAAQO,OACxCH,EAAqBG,OAAQ,EAC7BV,EAAeU,OAAQ,EAEvBW,OAAOK,QAAQC,aAAa,CAAE,EAAEC,SAASC,MAAO,IACjD,OAAQf,GACChB,EAAAiB,SAAS,gBAAiB,iFAClCrB,EAAOmB,KAAK,IAClB,CAAc,QACRP,EAAWI,OAAQ,CACzB,CACA"}