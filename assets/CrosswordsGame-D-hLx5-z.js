import{u as e,S as o}from"./SelectorsComponent-DC-sSRKM.js";import{u as t,G as r}from"./GamePerksMenu-btNo1kps.js";import{_ as l,r as n,v as a,c as s,o as u,b as c,d as i,f as d,n as f,F as v,h,e as w,t as g,i as p,m}from"./index-Cj7dyIox.js";const b={class:"crosswords-game"},y={id:"crossword-container"},k={key:0,class:"clue-number"},$=["id","data-row","data-col","data-correct","data-words","onClick"],C={id:"clues"},x=["onClick","title"],I={class:"button-container"},M={key:0,class:"loading-overlay"},B={class:"loading-message"},S=25,E=30,N=l({__name:"CrosswordsGame",setup(l){const{usePerk:N}=t(),F=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#ff24c0","#D4A5A5","#9B97B2","#FFB347","#87CEEB","#98FB98"],T=Math.floor(12.5),P=Math.floor(15),_=n([]),z=n([]),A=n(null),D=n("across"),J=n(new Set),O=n(new Set),j=n(null),G=a({}),R=n(!1),H=n(1),L=e(),V=n(!0),W=n({row:null,col:null,wordIndex:0}),U=s((()=>({gridTemplateColumns:"repeat(30, 40px)",gridTemplateRows:"repeat(25, 40px)"}))),q=s((()=>Array.from({length:S},((e,o)=>o)))),K=s((()=>Array.from({length:E},((e,o)=>o))));function Q(e,o){var t;return(null==(t=_.value[e])?void 0:t[o])||null}function X(e,o){const t=z.value.filter((t=>t.positions.some((t=>t.row===e&&t.col===o))));return JSON.stringify(t.map((e=>({wordNumber:e.number,direction:e.direction}))))}function Y(e,o){const t=z.value.filter((t=>t.positions.some((t=>t.row===e&&t.col===o))));return t.length>0?" "===Q(e,o)?"white":t[0].color+(function(e,o){return J.value.has(`${e}-${o}`)}(e,o)||function(e,o){return O.value.has(`${e}-${o}`)}(e,o)?"":"70"):"transparent"}function Z(e,o){const t=z.value.filter((t=>t.positions.some((t=>t.row===e&&t.col===o))));if(0===t.length)return{};const r={border:"1px solid var(--dark-border-color)",backgroundColor:"transparent"};let l=!1,n=!1;return t.forEach((e=>{e.positions.map((e=>`${e.row}-${e.col}`)).some((e=>J.value.has(e)))&&(r.backgroundColor="rgba(255, 255, 0, 0.1)","across"===e.direction?l=!0:n=!0)})),l&&(r.borderTop="3px solid darkgrey",r.borderBottom="3px solid darkgrey"),n&&(r.borderLeft="3px solid darkgrey",r.borderRight="3px solid darkgrey"),t.forEach((t=>{const a=t.positions.map((e=>`${e.row}-${e.col}`));a.some((e=>J.value.has(e)))&&("across"===t.direction&&l&&(a[0]===`${e}-${o}`&&(r.borderLeft="3px solid darkgrey"),a[a.length-1]===`${e}-${o}`&&(r.borderRight="3px solid darkgrey")),"down"===t.direction&&n&&(a[0]===`${e}-${o}`&&(r.borderTop="3px solid darkgrey"),a[a.length-1]===`${e}-${o}`&&(r.borderBottom="3px solid darkgrey")))})),r}function ee(e,o){return z.value.some((t=>t.row===e&&t.col===o))}function oe(e,o){const t=z.value.find((t=>t.row===e&&t.col===o));return null==t?void 0:t.number}function te(e){re(),e.positions.forEach((e=>{J.value.add(`${e.row}-${e.col}`)})),j.value=e.number}function re(){J.value.clear(),O.value.clear(),j.value=null}function le(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().trim()}function ne(e){const o=e.target,t=JSON.parse(o.dataset.words||"[]");if(t&&t.length>0&&(!A.value||!ae(o))){A.value=t[0],D.value=t[0].direction;const e=z.value.find((e=>e.number===t[0].wordNumber));e&&te(e)}if(!e.data||""===o.value)return o.value="",void function(e){const o=parseInt(e.dataset.row),t=parseInt(e.dataset.col);if(!A.value||!D.value)return;let r=o,l=t;"across"===D.value?l--:r--;const n=G[`${r}-${l}`];n&&ae(n)&&(n.focus(),n.select())}(o);o.value=e.data.toUpperCase(),o.select(),function(e){const o=parseInt(e.dataset.row),t=parseInt(e.dataset.col);if(!A.value||!D.value)return;let r=o,l=t;"across"===D.value?l++:r++;const n=G[`${r}-${l}`];n&&ae(n)&&n.focus()}(o)}function ae(e){if(!A.value||!D.value)return!1;const o=JSON.parse(e.dataset.words||"[]");if(!o||0===o.length)return!1;const t=z.value.find((e=>e.number===A.value.wordNumber));if(!t)return!1;const r=parseInt(e.dataset.row),l=parseInt(e.dataset.col);return"across"===D.value?r===t.row&&l>=t.col&&l<t.col+t.word.length:l===t.col&&r>=t.row&&r<t.row+t.word.length}function se(){let e=!0;for(const o in G){const t=G[o];le(t.value||"")===le(t.dataset.correct)?t.style.backgroundColor="#b2ffb2":(t.style.backgroundColor="#ffb2b2",t.value=t.dataset.correct,t.style.color="#FF0000",e=!1)}e&&(alert("Parabéns! Você completou corretamente!"),we())}function ue(e,o,t,r){if("across"===r){if(t<0||t+e.length>E||o<0||o>=S)return!1;let r=!1;for(let a=0;a<e.length;a++){const l=_.value[o][t+a];if(l){if(l!==e[a])return!1;r=!0}const n=o>0?_.value[o-1][t+a]:null,s=o<24?_.value[o+1][t+a]:null;if(n&&!ce(o-1,t+a)||s&&!ce(o+1,t+a))return!1}const l=t>0?_.value[o][t-1]:null,n=t+e.length<E?_.value[o][t+e.length]:null;return!l&&!n&&(0===z.value.length||r)}if("down"===r){if(o<0||o+e.length>S||t<0||t>=E)return!1;let r=!1;for(let a=0;a<e.length;a++){const l=_.value[o+a][t];if(l){if(l!==e[a])return!1;r=!0}const n=t>0?_.value[o+a][t-1]:null,s=t<29?_.value[o+a][t+1]:null;if(n&&!ce(o+a,t-1)||s&&!ce(o+a,t+1))return!1}const l=o>0?_.value[o-1][t]:null,n=o+e.length<S?_.value[o+e.length][t]:null;return!l&&!n&&(0===z.value.length||r)}return!1}function ce(e,o){return z.value.some((t=>"across"===t.direction?e===t.row&&o>=t.col&&o<t.col+t.word.length:"down"===t.direction&&(o===t.col&&e>=t.row&&e<t.row+t.word.length)))}async function ie(e,o,t,r,l=!0){const n=[];if("across"===r)for(let a=0;a<e.length;a++)null===_.value[o][t+a]&&(_.value[o][t+a]=l?"?":e[a],n.push({row:o,col:t+a}));else for(let a=0;a<e.length;a++)null===_.value[o+a][t]&&(_.value[o+a][t]=l?"?":e[a],n.push({row:o+a,col:t}));return l&&(await async function(e){return new Promise((o=>setTimeout(o,e)))}(20),n.forEach((e=>{"?"===_.value[e.row][e.col]&&(_.value[e.row][e.col]=null)}))),n}function de(e,o,t,r){let l=0;if("across"===r)for(let n=0;n<e.length;n++)null!==_.value[o][t+n]&&_.value[o][t+n]===e[n]&&l++;else for(let n=0;n<e.length;n++)null!==_.value[o+n][t]&&_.value[o+n][t]===e[n]&&l++;return l}function fe(e,o){const t=[];for(let r=0;r<S;r++)for(let l=0;l<E;l++)if(ue(e,r,l,o)){const n=de(e,r,l,o);t.push({row:r,col:l,direction:o,intersections:n})}return t.sort(((e,o)=>o.intersections-e.intersections)),t}async function ve(e){for(;z.value.length<5;){let o=!1;const t=new Set;for(;!o&&t.size<e.length;){let r;do{r=Math.floor(Math.random()*e.length)}while(t.has(r));t.add(r);const l=e[r],n=[];for(const e of["across","down"]){const o=await fe(l.word,e);n.push(...o)}if(n.length>0){n.sort(((e,o)=>o.intersections-e.intersections));const t=n.slice(0,Math.min(3,n.length)),a=t[Math.floor(Math.random()*t.length)];await ie(l.word,a.row,a.col,a.direction,!0);const s=await ie(l.word,a.row,a.col,a.direction,!1);if(s.length>0){z.value.push({word:l.word,clue:l.clue,row:a.row,col:a.col,direction:a.direction,positions:s,number:z.value.length+1,color:F[z.value.length%F.length]}),e.splice(r,1),o=!0;break}}}if(!o)return!1}return 5===z.value.length}async function he(e){if(H.value>5)return!1;!function(){_.value=[];for(let e=0;e<S;e++)_.value.push(new Array(E).fill(null));for(const e in G){const o=G[e];o&&(o.value="",o.style.backgroundColor="transparent",o.style.color="var(--text-color)")}z.value=[],re(),A.value=null,D.value="across",_.value.forEach((e=>e.fill(null)))}(),setTimeout((()=>function(){const e=document.getElementById("crossword");if(e){const o=(e.scrollWidth-e.clientWidth)/2,t=(e.scrollHeight-e.clientHeight)/2;e.scrollTo({left:o,top:t,behavior:"smooth"})}}()),100);const o=[...e],t=new Set;for(;t.size<o.length;){let e;do{e=Math.floor(Math.random()*o.length)}while(t.has(e));t.add(e);const r=o[e],l=await ie(r.word,T,Math.floor(P-r.word.length/2),"across",!1);if(l.length>0){z.value.push({word:r.word,clue:r.clue,row:T,col:Math.floor(P-r.word.length/2),direction:"across",positions:l,number:1,color:F[0]}),o.splice(e,1);if(await ve(o))return!0}}return H.value++,!1}async function we(e=!1){if(e||V.value)try{R.value=!0;const e=L.filteredWords;!(await he(e))&&H.value<5&&await we(!0)}catch(o){}finally{R.value=!1,re(),V.value=!1}}async function ge(e){if(await N(e)&&"hint"===e){const e=Object.values(G).filter((e=>e&&""===e.value));if(e.length>0){const o=e[Math.floor(Math.random()*e.length)];o.value=o.dataset.correct,o.style.backgroundColor="#ffe066",setTimeout((()=>{o.style.backgroundColor=""}),1e3)}}}return u((()=>{we()})),(e,t)=>(p(),c("div",b,[i("div",y,[i("div",{id:"crossword",style:f(U.value)},[(p(!0),c(v,null,h(q.value,(e=>(p(),c(v,{key:e},[(p(!0),c(v,null,h(K.value,(o=>(p(),c("div",{key:`${e}-${o}`,class:m(["cell",{empty:!Q(e,o)}]),style:f(Q(e,o)?Z(e,o):{})},[Q(e,o)?(p(),c(v,{key:0},[ee(e,o)?(p(),c("span",k,g(oe(e,o)),1)):d("",!0),i("input",{id:`cell-${e}-${o}`,ref_for:!0,ref:t=>G[`${e}-${o}`]=t,maxLength:"1","data-row":e,"data-col":o,"data-correct":Q(e,o),"data-words":X(e,o),style:f({backgroundColor:Y(e,o)}),onInput:ne,onClick:t=>function(e,o){const t=JSON.parse(X(e,o));if(0===t.length)return;W.value.row!==e||W.value.col!==o?W.value={row:e,col:o,wordIndex:0}:W.value.wordIndex=(W.value.wordIndex+1)%t.length;const r=z.value.find((e=>e.number===t[W.value.wordIndex].wordNumber));if(r){te(r);const t=G[`${e}-${o}`];t&&t.select()}}(e,o)},null,44,$)],64)):d("",!0)],6)))),128))],64)))),128))],4),i("div",C,[t[3]||(t[3]=i("h1",null,"Palavras Cruzadas",-1)),w(r,{availablePerks:["hint","extra_time","skip"],onPerkActivated:ge}),w(o,{onSpecialtyChange:t[0]||(t[0]=e=>we(!0)),onDifficultyChange:t[1]||(t[1]=e=>we(!0))}),i("ul",{id:"clue-list",style:f({display:R.value?"none":"block"})},[(p(!0),c(v,null,h(z.value,(e=>{return p(),c("li",{key:e.number,class:m({highlighted:(o=e.number,j.value===o)}),onClick:o=>te(e),style:f({borderBottom:`2px solid ${e.color}`}),title:e.word},g(e.number)+". "+g(e.clue)+" ("+g("across"===e.direction?"Horizontal":"Vertical")+") ",15,x);var o})),128))],4)]),i("div",I,[i("button",{id:"check-button",onClick:se},"Verificar Respostas"),i("button",{id:"new-game-button",onClick:t[2]||(t[2]=e=>we(!0))},"Novo Jogo")])]),R.value?(p(),c("div",M,[i("div",B,[t[4]||(t[4]=i("p",null,"Gerando palavras cruzadas...",-1)),i("p",null,"Tentativa "+g(H.value)+" de "+g(5),1)])])):d("",!0)]))}},[["__scopeId","data-v-ad51f857"]]);export{N as default};
//# sourceMappingURL=CrosswordsGame-D-hLx5-z.js.map
